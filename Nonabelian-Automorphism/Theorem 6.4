ii)
F[x_, y_] := k*x^2 - 2*d*x*y + d*k*y^2;
G[x_, y_] := x^2 - 2*k*x*y + d*y^2;
Phi13star[X_, Y_] := (Phistar3[F[X, Y], G[X, Y]])/(Phistar3[X, Y]);
Phistar3[X_, Y_] := H3[X, Y]/(H1[X, Y]);
Phi13star[X_, Y_] := (Phistar3[F[X, Y], G[X, Y]])/(Phistar3[X, Y]);

C13[X_, k_, d_] := (d^4 + k^2 X^6 + 3 d X^4 (11 k^2 - 8 k X + X^2) + 3 d^3 (k^2 - 8 k X + 11 X^2) + d^2 X^2 (27 k^2 - 80 k X + 27 X^2));
C13[X, 1, d] =    d^4 + X^6 + 3 d X^4 (11 - 8 X + X^2) + 3 d^3 (1 - 8 X + 11 X^2) + d^2 X^2 (27 - 80 X + 27 X^2);

P<X,d>:=AffineSpace(Rationals(),2);
C13:= Curve(P, d^4 + X^6 + 3*d*X^4*(11 - 8*X + X^2) + 3*d^3*(1 - 8*X + 11*X^2) + 
 d^2*X^2*(27 - 80*X + 27*X^2));
PC13:=ProjectiveClosure(C13);
P<X,d,W>:=AmbientSpace(PC13);
PC13;
SingularPoints(C13);
IrreducibleComponents(PC13);

Curve over Rational Field defined by
X^6*d + 1/3*X^6*W - 8*X^5*d*W + 9*X^4*d^2*W + 11*X^4*d*W^2 - 80/3*X^3*d^2*W^2 +
    11*X^2*d^3*W^2 + 9*X^2*d^2*W^3 - 8*X*d^3*W^3 + 1/3*d^4*W^3 + d^3*W^4
{@ (0, 0), (1, 1) @}
[
    Scheme over Rational Field defined by
    X^6*d + 1/3*X^6*W - 8*X^5*d*W + 9*X^4*d^2*W + 11*X^4*d*W^2 -
        80/3*X^3*d^2*W^2 + 11*X^2*d^3*W^2 + 9*X^2*d^2*W^3 - 8*X*d^3*W^3 +
        1/3*d^4*W^3 + d^3*W^4
]

P<X,d,W>:=ProjectiveSpace(Rationals(),2);
PC13 := Curve(P, X^6*d + 1/3*X^6*W - 8*X^5*d*W + 9*X^4*d^2*W + 11*X^4*d*W^2 - 80/3*X^3*d^2*W^2 +
    11*X^2*d^3*W^2 + 9*X^2*d^2*W^3 - 8*X*d^3*W^3 + 1/3*d^4*W^3 + d^3*W^4);
k:=FieldOfGeometricIrreducibility(PC13);
k;
Genus(PC13);
SingularPoints(PC13);

Rational Field
0
{@ (0 : 0 : 1), (1 : 1 : 1), (0 : 1 : 0) @}

P1<s,t>; := ProjectiveSpace(Rationals(), 1);
P<z,d,W>;:=ProjectiveSpace(Rationals(),2);
C:=Curve(P, z^6*d + 1/3*z^6*W - 8*z^5*d*W + 9*z^4*d^2*W + 11*z^4*d*W^2 -
80/3*z^3*d^2*W^2 +
11*z^2*d^3*W^2 + 9*z^2*d^2*W^3 - 8*z*d^3*W^3 + 1/3*d^4*W^3 + d^3*W^4);
k:=FieldOfGeometricIrreducibility(C);
k;
SingularPoints(C);
Genus(C);
k:=FieldOfGeometricIrreducibility(C);
k;
Q:=C![1,0,0];
phi:=Parametrization(C,Place(Q),Curve(P1));
phi;

iii)
F[x_, y_] := k*x^2 - 2*d*x*y + d*k*y^2
G[x_, y_] := x^2 - 2*k*x*y + d*y^2;
H1[x_, y_] := y*F[x, y] - x*G[x, y] ;
f[x_, y_] := F[F[x, y], G[x, y]];
g[x_, y_] := G[F[x, y], G[x, y]];
H3[x_, y_] := y*F[f[x, y], g[x, y]] - x*G[f[x, y], g[x, y]] ;
Phistar3[X_, Y_] := H3[X, Y]/(H1[X, Y]);
Phi23star[X_, Y_] := (Phistar3[f[X, Y], g[X, Y]])/(Phistar3[F[X, Y], G[X, Y]]);
C23[X_, k_, d_] := (d^8 + k^4 X^12 + 2 d k^2 X^10 (69 k^2 - 48 k X + 7 X^2) + 
    2 d^7 (7 k^2 - 48 k X + 69 X^2) + 
    d^2 X^8 (975 k^4 - 1760 k^3 X + 780 k^2 X^2 - 96 k X^3 + X^4) + 
    2 d^3 X^6 (934 k^4 - 3168 k^3 X + 2985 k^2 X^2 - 880 k X^3 + 
       69 X^4) + 
    2 d^5 X^2 (69 k^4 - 880 k^3 X + 2985 k^2 X^2 - 3168 k X^3 + 
       934 X^4) + 
    d^4 X^4 (975 k^4 - 6336 k^3 X + 11048 k^2 X^2 - 6336 k X^3 + 
       975 X^4) + 
    d^6 (k^4 - 96 k^3 X + 780 k^2 X^2 - 1760 k X^3 + 975 X^4));

 P<X,d>:=AffineSpace(Rationals(),2);
C23 := Curve(P, d^8 + X^12 + 2*d*X^10*(69 - 48*X + 7*X^2) + 
 2*d^7*(7 - 48*X + 69*X^2) + 
 d^2*X^8*(975 - 1760*X + 780*X^2 - 96*X^3 + X^4) + 
 2*d^3*X^6*(934 - 3168*X + 2985*X^2 - 880*X^3 + 69*X^4) + 
 2*d^5*X^2*(69 - 880*X + 2985*X^2 - 3168*X^3 + 934*X^4) + 
 d^4*X^4*(975 - 6336*X + 11048*X^2 - 6336*X^3 + 975*X^4) + 
 d^6*(1 - 96*X + 780*X^2 - 1760*X^3 + 975*X^4));
PC23:=ProjectiveClosure(C23);
P<X,d,W>:=AmbientSpace(PC23);
PC23;
SingularPoints(C23);
Genus(C23);

Curve over Rational Field defined by
X^12*d^2 + 14*X^12*d*W - 96*X^11*d^2*W + 138*X^10*d^3*W + X^12*W^2 -
    96*X^11*d*W^2 + 780*X^10*d^2*W^2 - 1760*X^9*d^3*W^2 + 975*X^8*d^4*W^2 +
    138*X^10*d*W^3 - 1760*X^9*d^2*W^3 + 5970*X^8*d^3*W^3 - 6336*X^7*d^4*W^3 +
    1868*X^6*d^5*W^3 + 975*X^8*d^2*W^4 - 6336*X^7*d^3*W^4 + 11048*X^6*d^4*W^4 -
    6336*X^5*d^5*W^4 + 975*X^4*d^6*W^4 + 1868*X^6*d^3*W^5 - 6336*X^5*d^4*W^5 +
    5970*X^4*d^5*W^5 - 1760*X^3*d^6*W^5 + 138*X^2*d^7*W^5 + 975*X^4*d^4*W^6 -
    1760*X^3*d^5*W^6 + 780*X^2*d^6*W^6 - 96*X*d^7*W^6 + d^8*W^6 +
    138*X^2*d^5*W^7 - 96*X*d^6*W^7 + 14*d^7*W^7 + d^6*W^8
{@ (0, 0), (1, 1) @}
0

P<X,d,W>:=ProjectiveSpace(Rationals(),2);
PC23:=Curve(P, X^12*d^2 + 14*X^12*d*W - 96*X^11*d^2*W + 138*X^10*d^3*W + X^12*W^2 -
    96*X^11*d*W^2 + 780*X^10*d^2*W^2 - 1760*X^9*d^3*W^2 + 975*X^8*d^4*W^2 +
    138*X^10*d*W^3 - 1760*X^9*d^2*W^3 + 5970*X^8*d^3*W^3 - 6336*X^7*d^4*W^3 +
    1868*X^6*d^5*W^3 + 975*X^8*d^2*W^4 - 6336*X^7*d^3*W^4 + 11048*X^6*d^4*W^4 -
    6336*X^5*d^5*W^4 + 975*X^4*d^6*W^4 + 1868*X^6*d^3*W^5 - 6336*X^5*d^4*W^5 +
    5970*X^4*d^5*W^5 - 1760*X^3*d^6*W^5 + 138*X^2*d^7*W^5 + 975*X^4*d^4*W^6 -
    1760*X^3*d^5*W^6 + 780*X^2*d^6*W^6 - 96*X*d^7*W^6 + d^8*W^6 +
    138*X^2*d^5*W^7 - 96*X*d^6*W^7 + 14*d^7*W^7 + d^6*W^8);
SingularPoints(PC23);
k:=FieldOfGeometricIrreducibility(PC23);
k;

{@ (0 : 0 : 1), (1 : 1 : 1), (0 : 1 : 0), (1 : 0 : 0) @}
Number Field with defining polynomial $.1^2 + 4715/32*$.1 + 22034617/4096 over
the Rational Field

R<X> := PolynomialRing(Rationals());
 f := X^2 + 4715/32*X + 22034617/4096;
k := NumberField(f);
P<X,d,W>:=ProjectiveSpace(k,2);
PC23:=Curve(P, X^12*d^2 + 14*X^12*d*W - 96*X^11*d^2*W + 138*X^10*d^3*W + X^12*W^2 -
    96*X^11*d*W^2 + 780*X^10*d^2*W^2 - 1760*X^9*d^3*W^2 + 975*X^8*d^4*W^2 +
    138*X^10*d*W^3 - 1760*X^9*d^2*W^3 + 5970*X^8*d^3*W^3 - 6336*X^7*d^4*W^3 +
    1868*X^6*d^5*W^3 + 975*X^8*d^2*W^4 - 6336*X^7*d^3*W^4 + 11048*X^6*d^4*W^4 -
    6336*X^5*d^5*W^4 + 975*X^4*d^6*W^4 + 1868*X^6*d^3*W^5 - 6336*X^5*d^4*W^5 +
    5970*X^4*d^5*W^5 - 1760*X^3*d^6*W^5 + 138*X^2*d^7*W^5 + 975*X^4*d^4*W^6 -
    1760*X^3*d^5*W^6 + 780*X^2*d^6*W^6 - 96*X*d^7*W^6 + d^8*W^6 +
    138*X^2*d^5*W^7 - 96*X*d^6*W^7 + 14*d^7*W^7 + d^6*W^8);
IrreducibleComponents(PC23);

[
    Scheme over k defined by
    X^6*d + 1/64*(-64*k.1 - 4267)*X^6*W + 1/32*(192*k.1 + 12609)*X^5*d*W +
        1/64*(-576*k.1 - 38019)*X^4*d^2*W + 1/32*(-192*k.1 - 12513)*X^4*d*W^2 +
        1/16*(320*k.1 + 21015)*X^3*d^2*W^2 + 1/32*(-192*k.1 - 12513)*X^2*d^3*W^2
        + 1/64*(-576*k.1 - 38019)*X^2*d^2*W^3 + 1/32*(192*k.1 + 12609)*X*d^3*W^3
        + 1/64*(-64*k.1 - 4267)*d^4*W^3 + d^3*W^4,
    Scheme over k defined by
    X^6*d + 1/64*(64*k.1 + 5163)*X^6*W + 1/32*(-192*k.1 - 15681)*X^5*d*W +
        1/64*(576*k.1 + 46851)*X^4*d^2*W + 1/32*(192*k.1 + 15777)*X^4*d*W^2 +
        1/16*(-320*k.1 - 26135)*X^3*d^2*W^2 + 1/32*(192*k.1 + 15777)*X^2*d^3*W^2
        + 1/64*(576*k.1 + 46851)*X^2*d^2*W^3 + 1/32*(-192*k.1 - 15681)*X*d^3*W^3
        + 1/64*(64*k.1 + 5163)*d^4*W^3 + d^3*W^4
]

For the first scheme;

function collect(f, i)
    R := Parent(f);
    K := BaseRing(R);
    n := Rank(R);

    // Check if i is within valid range (manual error handling)
    if i lt 1 or i gt n then
        error "Variable index out of bounds";
    end if;

    // Indices of the other variables
    others := [1..n];
    Remove(~others, i);

    // Create the coefficient ring with the other variables
    Snames := [Names(R)[j] : j in others];
    S := PolynomialRing(K, #others);
    AssignNames(~S, Snames);

    // Create the univariate ring over S for the i-th variable
    S1<y> := PolynomialRing(S);
    AssignNames(~S1, [Names(R)[i]]);

    // Define the homomorphism from R to S1
    hom_images := [];
    for j in [1..n] do
        if j eq i then
            Append(~hom_images, S1.1); // y (the i-th variable)
        else
            pos := Index(others, j);
            Append(~hom_images, S.pos); // Other variables mapped to S
        end if;
    end for;

    hom := hom< R -> S1 | hom_images >;

    // Map the polynomial to the new ring
    g := hom(f);
    return g, S1;
end function;

K := Rationals();
R<k, X, d, W> := PolynomialRing(K, 4);
f :=X^6*d + 1/64*(-64*k - 4267)*X^6*W + 1/32*(192*k + 12609)*X^5*d*W +
        1/64*(-576*k - 38019)*X^4*d^2*W + 1/32*(-192*k - 12513)*X^4*d*W^2 +
        1/16*(320*k + 21015)*X^3*d^2*W^2 + 1/32*(-192*k - 12513)*X^2*d^3*W^2
        + 1/64*(-576*k - 38019)*X^2*d^2*W^3 + 1/32*(192*k + 12609)*X*d^3*W^3
        + 1/64*(-64*k - 4267)*d^4*W^3 + d^3*W^4;
// Collect terms with respect to x (first variable)
g, S1 := collect(f, 1);

// Output will be:
// (y + 3)*y^2 + (z)*y + 2*z
// Where y in S1 represents the original x variable
g, S1;
f eq X^6*d + 1/64*(-64*k - 4267)*X^6*W + 1/32*(192*k + 12609)*X^5*d*W +
        1/64*(-576*k - 38019)*X^4*d^2*W + 1/32*(-192*k - 12513)*X^4*d*W^2 +
        1/16*(320*k + 21015)*X^3*d^2*W^2 + 1/32*(-192*k - 12513)*X^2*d^3*W^2
        + 1/64*(-576*k - 38019)*X^2*d^2*W^3 + 1/32*(192*k + 12609)*X*d^3*W^3
        + 1/64*(-64*k - 4267)*d^4*W^3 + d^3*W^4;

        (-X^6*W + 6*X^5*d*W - 9*X^4*d^2*W - 6*X^4*d*W^2 + 20*X^3*d^2*W^2 - 6*X^2*d^3*W^2
    - 9*X^2*d^2*W^3 + 6*X*d^3*W^3 - d^4*W^3)*k + X^6*d - 4267/64*X^6*W +
    12609/32*X^5*d*W - 38019/64*X^4*d^2*W - 12513/32*X^4*d*W^2 +
    21015/16*X^3*d^2*W^2 - 12513/32*X^2*d^3*W^2 - 38019/64*X^2*d^2*W^3 +
    12609/32*X*d^3*W^3 - 4267/64*d^4*W^3 + d^3*W^4
Univariate Polynomial Ring in k over Polynomial ring of rank 3 over Rational
    Field
true

For the second scheme

function collect(f, i)
    R := Parent(f);
    K := BaseRing(R);
    n := Rank(R);

    // Check if i is within valid range (manual error handling)
    if i lt 1 or i gt n then
        error "Variable index out of bounds";
    end if;

    // Indices of the other variables
    others := [1..n];
    Remove(~others, i);

    // Create the coefficient ring with the other variables
    Snames := [Names(R)[j] : j in others];
    S := PolynomialRing(K, #others);
    AssignNames(~S, Snames);

    // Create the univariate ring over S for the i-th variable
    S1<y> := PolynomialRing(S);
    AssignNames(~S1, [Names(R)[i]]);

    // Define the homomorphism from R to S1
    hom_images := [];
    for j in [1..n] do
        if j eq i then
            Append(~hom_images, S1.1); // y (the i-th variable)
        else
            pos := Index(others, j);
            Append(~hom_images, S.pos); // Other variables mapped to S
        end if;
    end for;

    hom := hom< R -> S1 | hom_images >;

    // Map the polynomial to the new ring
    g := hom(f);
    return g, S1;
end function;

K := Rationals();
R<k, X, d, W> := PolynomialRing(K, 4);
f :=X^6*d + 1/64*(64*k + 5163)*X^6*W + 1/32*(-192*k - 15681)*X^5*d*W +
        1/64*(576*k + 46851)*X^4*d^2*W + 1/32*(192*k + 15777)*X^4*d*W^2 +
        1/16*(-320*k - 26135)*X^3*d^2*W^2 + 1/32*(192*k + 15777)*X^2*d^3*W^2
        + 1/64*(576*k + 46851)*X^2*d^2*W^3 + 1/32*(-192*k - 15681)*X*d^3*W^3
        + 1/64*(64*k + 5163)*d^4*W^3 + d^3*W^4;


// Collect terms with respect to x (first variable)
g, S1 := collect(f, 1);

// Output will be:
// (y + 3)*y^2 + (z)*y + 2*z
// Where y in S1 represents the original x variable
g, S1;
f eq X^6*d + 1/64*(64*k + 5163)*X^6*W + 1/32*(-192*k - 15681)*X^5*d*W +
        1/64*(576*k + 46851)*X^4*d^2*W + 1/32*(192*k + 15777)*X^4*d*W^2 +
        1/16*(-320*k - 26135)*X^3*d^2*W^2 + 1/32*(192*k + 15777)*X^2*d^3*W^2
        + 1/64*(576*k + 46851)*X^2*d^2*W^3 + 1/32*(-192*k - 15681)*X*d^3*W^3
        + 1/64*(64*k + 5163)*d^4*W^3 + d^3*W^4;

        (X^6*W - 6*X^5*d*W + 9*X^4*d^2*W + 6*X^4*d*W^2 - 20*X^3*d^2*W^2 + 6*X^2*d^3*W^2
    + 9*X^2*d^2*W^3 - 6*X*d^3*W^3 + d^4*W^3)*k + X^6*d + 5163/64*X^6*W -
    15681/32*X^5*d*W + 46851/64*X^4*d^2*W + 15777/32*X^4*d*W^2 -
    26135/16*X^3*d^2*W^2 + 15777/32*X^2*d^3*W^2 + 46851/64*X^2*d^2*W^3 -
    15681/32*X*d^3*W^3 + 5163/64*d^4*W^3 + d^3*W^4
Univariate Polynomial Ring in k over Polynomial ring of rank 3 over Rational
    Field
true

P<X,d,W>:=ProjectiveSpace(Rationals(),2);
C1 := Scheme(P, [(-X^6*W + 6*X^5*d*W - 9*X^4*d^2*W - 6*X^4*d*W^2 + 20*X^3*d^2*W^2 - 6*X^2*d^3*W^2
    - 9*X^2*d^2*W^3 + 6*X*d^3*W^3 - d^4*W^3), X^6*d - 4267/64*X^6*W +
    12609/32*X^5*d*W - 38019/64*X^4*d^2*W - 12513/32*X^4*d*W^2 +
    21015/16*X^3*d^2*W^2 - 12513/32*X^2*d^3*W^2 - 38019/64*X^2*d^2*W^3 +
    12609/32*X*d^3*W^3 - 4267/64*d^4*W^3 + d^3*W^4]);
Dimension(C1);
Points(C1);
C2 := Scheme(P, [(X^6*W - 6*X^5*d*W + 9*X^4*d^2*W + 6*X^4*d*W^2 - 20*X^3*d^2*W^2 + 6*X^2*d^3*W^2
    + 9*X^2*d^2*W^3 - 6*X*d^3*W^3 + d^4*W^3),  X^6*d + 5163/64*X^6*W -
    15681/32*X^5*d*W + 46851/64*X^4*d^2*W + 15777/32*X^4*d*W^2 -
    26135/16*X^3*d^2*W^2 + 15777/32*X^2*d^3*W^2 + 46851/64*X^2*d^2*W^3 -
    15681/32*X*d^3*W^3 + 5163/64*d^4*W^3 + d^3*W^4 ]);
Dimension(C2);
Points(C2);
0
{@ (0 : 0 : 1), (1 : 1 : 1), (0 : 1 : 0), (1 : 0 : 0) @}
0
{@ (0 : 0 : 1), (1 : 1 : 1), (0 : 1 : 0), (1 : 0 : 0) @}
